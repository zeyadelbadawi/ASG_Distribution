"use strict";(()=>{var e={};e.id=8342,e.ids=[8342],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},3512:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>j,patchFetch:()=>x,requestAsyncStorage:()=>S,routeModule:()=>w,serverHooks:()=>v,staticGenerationAsyncStorage:()=>E});var s={};t.r(s),t.d(s,{DELETE:()=>y,GET:()=>h,POST:()=>m,PUT:()=>f});var a=t(9303),i=t(8716),o=t(3131),n=t(7147),l=t.n(n),c=t(1017),p=t.n(c);let g=p().join(process.cwd(),"storage"),u=p().join(g,"blog.json"),d=p().join(process.cwd(),"public/assets/images/blog");async function m(e){try{let r=await e.formData(),{id:t,date:s,title:a,category:i,comments:o,description:n,description2:c,reviews:g}=Object.fromEntries(r.entries()),m=r.get("image"),f="";if(m&&m.size>0)try{l().existsSync(d)||(l().mkdirSync(d,{recursive:!0}),console.log("Created image storage directory:",d));let e=p().join(d,m.name),r=await m.arrayBuffer();await l().promises.writeFile(e,Buffer.from(r)),f=`/assets/images/blog/${m.name}`,console.log("Image uploaded successfully. Updated imageUrl:",f)}catch(e){throw console.error("Error uploading image:",e),Error("Failed to upload image.")}else console.log("No image provided or image size is zero.");let y=[];for(let e of r.entries())if(e[0].startsWith("multiImage")){let r=e[1];if(r&&r.size>0)try{let e=p().join(d,r.name),t=await r.arrayBuffer();await l().promises.writeFile(e,Buffer.from(t)),y.push(`/assets/images/blog/${r.name}`)}catch(e){throw console.error("Error uploading multiple images:",e),Error("Failed to upload multiple images.")}}g=g?g.split(","):[];let h={id:t,date:s,title:a,description:n,description2:c,category:i,comments:o,reviews:g,imageUrl:f,multiImageUrls:y};console.log("Constructed blog object:",h);let w=[];if(l().existsSync(u))try{let e=l().readFileSync(u,"utf-8");w=JSON.parse(e)}catch(e){throw console.error("Error parsing existing blog data:",e),Error("Invalid JSON format in blog.json file.")}return w.push(h),l().writeFileSync(u,JSON.stringify(w,null,2)),console.log("Blog data saved successfully. Final imageUrl:",f),new Response(JSON.stringify({message:"Data saved successfully!"}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Error in POST method:",e),new Response(JSON.stringify({message:`Error saving server data: ${e.message}`}),{status:500,headers:{"Content-Type":"application/json"}})}}async function f(e){try{let r=parseInt(new URL(e.url).searchParams.get("index")),t=await e.formData(),s=[];if(l().existsSync(u)){let e=l().readFileSync(u,"utf-8");s=JSON.parse(e)}let a=s[r],i=t.get("id")||a.id,o=t.get("date")||a.date,n=t.get("title")||a.title,c=t.get("description")||a.description,g=t.get("description2")||a.description2,m=t.get("category")||a.category,f=t.get("comments")||a.comments;t.get("reviews")||a.reviews;let y=a.imageUrl,h=a.multiImageUrls||[],w=t.get("image");if(w&&w.size>0)try{let e=p().join(d,w.name),r=await w.arrayBuffer();await l().promises.writeFile(e,Buffer.from(r)),y=`/assets/images/blog/${w.name}`}catch(e){throw console.error("Error uploading image:",e),Error("Failed to upload image.")}for(let e of(h=[],t.entries()))if(e[0].startsWith("multiImage")){let r=e[1];if(r&&r.size>0)try{let e=p().join(d,r.name),t=await r.arrayBuffer();await l().promises.writeFile(e,Buffer.from(t)),h.push(`/assets/images/blog/${r.name}`)}catch(e){throw console.error("Error uploading multiple images:",e),Error("Failed to upload multiple images.")}}let S=t.get("reviews")?t.get("reviews").split(","):a.reviews,E={id:i,date:o,title:n,description:c,description2:g,category:m,comments:f,reviews:S,imageUrl:y,multiImageUrls:h};return s[r]=E,l().writeFileSync(u,JSON.stringify(s,null,2)),console.log("Blog data updated successfully."),new Response(JSON.stringify({message:"Data updated successfully!"}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Error in PUT method:",e),new Response(JSON.stringify({message:`Error updating server data: ${e.message}`}),{status:500,headers:{"Content-Type":"application/json"}})}}async function y(e){try{let r=parseInt(new URL(e.url).searchParams.get("index")),t=[];if(l().existsSync(u)){let e=l().readFileSync(u,"utf-8");t=JSON.parse(e)}return t.splice(r,1),l().writeFileSync(u,JSON.stringify(t,null,2)),console.log("Blog data deleted successfully."),new Response(JSON.stringify({message:"Data deleted successfully!"}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Error in DELETE method:",e),new Response(JSON.stringify({message:`Error deleting server data: ${e.message}`}),{status:500,headers:{"Content-Type":"application/json"}})}}async function h(){try{if(!l().existsSync(u))return new Response(JSON.stringify([]),{status:200,headers:{"Content-Type":"application/json"}});{let e=l().readFileSync(u,"utf-8"),r=JSON.parse(e);return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}}catch(e){return console.error("Error in GET method:",e),new Response(JSON.stringify({message:"Error fetching server data."}),{status:500,headers:{"Content-Type":"application/json"}})}}l().existsSync(g)||(l().mkdirSync(g,{recursive:!0}),console.log("Created storage directory:",g)),l().existsSync(u)||(l().writeFileSync(u,"[]","utf-8"),console.log("Created blog.json file with an empty array."));let w=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/blog/route",pathname:"/api/blog",filename:"route",bundlePath:"app/api/blog/route"},resolvedPagePath:"/home/ziad/ASG_Distribution/app/api/blog/route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:S,staticGenerationAsyncStorage:E,serverHooks:v}=w,j="/api/blog/route";function x(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:E})}},9303:(e,r,t)=>{e.exports=t(517)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948],()=>t(3512));module.exports=s})();